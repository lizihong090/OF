<script type="module">
async function fetchWeather() {
  const lat = 23.7078; // 虎尾緯度
  const lon = 120.4310; // 虎尾經度

  try {
    const res = await fetch(`http://localhost:3000/weather?lat=${lat}&lon=${lon}`);
    const data = await res.json();

    // 更新 DOM
    document.getElementById('weatherTemp').textContent = data.main.temp.toFixed(1);
    document.getElementById('weatherHumidity').textContent = data.main.humidity;
    document.getElementById('weatherWind').textContent = data.wind.speed;
    document.getElementById('weatherPressure').textContent = data.main.pressure;

    const weatherId = data.weather[0].id;
    const iconEl = document.getElementById('weatherIcon');
    const descEl = document.getElementById('weatherDesc');

    // 簡單圖示判斷
    if (weatherId < 300) iconEl.className = "fas fa-bolt", descEl.textContent = "雷雨";
    else if (weatherId < 600) iconEl.className = "fas fa-cloud-rain", descEl.textContent = "下雨";
    else if (weatherId < 700) iconEl.className = "fas fa-snowflake", descEl.textContent = "下雪";
    else if (weatherId < 800) iconEl.className = "fas fa-smog", descEl.textContent = "霧";
    else if (weatherId === 800) iconEl.className = "fas fa-sun", descEl.textContent = "晴朗";
    else iconEl.className = "fas fa-cloud", descEl.textContent = "多雲";

    document.getElementById('weatherUpdate').textContent = `最後更新: ${new Date().toLocaleTimeString()}`;
  } catch (err) {
    console.error(err);
  }
}

// 每 5 分鐘更新一次
fetchWeather();
setInterval(fetchWeather, 300000);
</script>

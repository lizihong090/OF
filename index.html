<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ESP 控制面板</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root {
    --primary: #00c6ff;
    --secondary: #0072ff;
    --dark-bg: #121212;
    --card-bg: #1e1e1e;
    --text-primary: #f0f0f0;
    --text-secondary: #a0a0a0;
    --success: #00c853;
    --danger: #ff3d00;
    --warning: #ffab00;
    --border-radius: 12px;
    --transition: all 0.3s ease;
  }
  body { background: linear-gradient(135deg, var(--dark-bg) 0%, #1a1a2e 100%); color: var(--text-primary); font-family: 'Segoe UI', Arial, sans-serif; min-height: 100vh; padding: 20px; display:flex; flex-direction:column; align-items:center; justify-content:center;}
  .container { width:100%; max-width:800px; margin:0 auto; }
  header { text-align:center; margin-bottom:30px; padding:20px; }
  h1 { font-size:2.5rem; background: linear-gradient(to right, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow:0 2px 10px rgba(0,198,255,0.2);}
  .subtitle { color: var(--text-secondary); font-size:1.1rem;}
  .dashboard { display:grid; grid-template-columns: repeat(auto-fit, minmax(300px,1fr)); gap:20px; margin-bottom:30px;}
  .card { background: var(--card-bg); border-radius: var(--border-radius); padding:25px; box-shadow:0 10px 20px rgba(0,0,0,0.3); transition:var(--transition); display:flex; flex-direction:column;}
  .card:hover { transform: translateY(-5px); box-shadow:0 15px 30px rgba(0,0,0,0.4);}
  .card-header { display:flex; align-items:center; margin-bottom:20px; }
  .card-icon { width:40px; height:40px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius:50%; display:flex; align-items:center; justify-content:center; margin-right:15px; }
  .card-title { font-size:1.3rem; font-weight:600;}
  .control-group { margin-bottom:20px; }
  .btn { padding:12px 25px; border:none; border-radius:50px; font-size:1rem; font-weight:600; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:var(--transition);}
  .btn-primary { background: linear-gradient(to right, var(--primary), var(--secondary)); color:white; box-shadow:0 4px 15px rgba(0,198,255,0.3);}
  .btn-primary:hover { box-shadow:0 6px 20px rgba(0,198,255,0.4); transform:translateY(-2px);}
  .btn-danger { background: var(--danger); color:white; box-shadow:0 4px 15px rgba(255,61,0,0.3);}
  .btn-danger:hover { box-shadow:0 6px 20px rgba(255,61,0,0.4); transform:translateY(-2px);}
  .slider-container { width:100%; margin:15px 0;}
  .slider-value { text-align:center; font-size:1.8rem; font-weight:700; margin:10px 0; color:var(--primary);}
  .slider { -webkit-appearance:none; width:100%; height:10px; border-radius:5px; background:#333; outline:none; margin:15px 0; }
  .slider::-webkit-slider-thumb { -webkit-appearance:none; appearance:none; width:25px; height:25px; border-radius:50%; background:var(--primary); cursor:pointer; box-shadow:0 0 15px rgba(0,198,255,0.5);}
  .status-indicator { display:flex; align-items:center; margin-top:10px; font-size:0.9rem; color:var(--text-secondary);}
  .status-dot { width:10px; height:10px; border-radius:50%; margin-right:8px;}
  .status-connected { background: var(--success); box-shadow:0 0 10px var(--success);}
  .status-disconnected { background: var(--danger); box-shadow:0 0 10px var(--danger);}
  .pulse-indicator { width:20px; height:20px; border-radius:50%; margin-left:10px; background: var(--warning); box-shadow:0 0 10px var(--warning); animation:pulse 2s infinite;}
  @keyframes pulse {0%{opacity:1;}50%{opacity:0.4;}100%{opacity:1;}}
  footer { text-align:center; margin-top:30px; color:var(--text-secondary); font-size:0.9rem;}
  @media (max-width:768px){.dashboard{grid-template-columns:1fr;} h1{font-size:2rem;}}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>ESP 控制面板</h1>
    <p class="subtitle">远程监控与控制设备</p>
  </header>

  <div class="dashboard">
    <!-- D4 控制 -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon"><i class="fas fa-lightbulb"></i></div>
        <h2 class="card-title">D4 输出控制</h2>
      </div>
      <div class="control-group">
        <button id="d4Btn" class="btn btn-primary"><i class="fas fa-power-off"></i> 开启 D4</button>
      </div>
      <div class="status-indicator">
        <div class="status-dot status-connected"></div>
        <span>状态: 已连接</span>
      </div>
    </div>

    <!-- D5 脈衝 -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon"><i class="fas fa-bolt"></i></div>
        <h2 class="card-title">D5 脉冲控制</h2>
      </div>
      <div class="control-group">
        <button id="d5Btn" class="btn btn-primary"><i class="fas fa-play"></i> 发送脉冲</button>
        <div class="status-indicator"><span>脉冲状态:</span><div class="pulse-indicator"></div></div>
      </div>
    </div>

    <!-- PWM 控制 -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon"><i class="fas fa-sliders-h"></i></div>
        <h2 class="card-title">PWM 调节器</h2>
      </div>
      <div class="control-group">
        <div class="slider-value"><span id="pwmVal">0</span></div>
        <div class="slider-container">
          <input type="range" id="pwmSlider" class="slider" min="0" max="1023" value="0">
        </div>
        <div class="status-indicator"><span>PWM 输出值: 0-1023</span></div>
      </div>
    </div>

    <!-- DHT22 溫濕度 -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon"><i class="fas fa-thermometer-half"></i></div>
        <h2 class="card-title">溫濕度 (DHT22)</h2>
      </div>
      <div class="control-group">
        <div class="slider-value">溫度: <span id="tempVal">--</span> ℃</div>
        <div class="slider-value">濕度: <span id="humVal">--</span> %</div>
      </div>
    </div>
  </div>

  <footer>ESP 控制面板 &copy; 2025</footer>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

// Firebase 設定
const firebaseConfig = {
  apiKey: "你的APIKey",
  authDomain: "of11-bf42c.firebaseapp.com",
  databaseURL: "https://of11-bf42c-default-rtdb.firebaseio.com",
  projectId: "of11-bf42c",
  storageBucket: "of11-bf42c.appspot.com",
  messagingSenderId: "你的ID",
  appId: "你的ID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const statusRef = ref(db, 'status');

const d4Btn = document.getElementById("d4Btn");
const d5Btn = document.getElementById("d5Btn");
const pwmSlider = document.getElementById("pwmSlider");
const pwmVal = document.getElementById("pwmVal");
const tempVal = document.getElementById("tempVal");
const humVal = document.getElementById("humVal");

// 監聽 Firebase 更新
onValue(statusRef, (snapshot) => {
  const data = snapshot.val() || {};
  d4Btn.innerHTML = data.ledD4 ? '<i class="fas fa-power-off"></i> 关闭 D4' : '<i class="fas fa-power-off"></i> 开启 D4';
  d4Btn.className = data.ledD4 ? 'btn btn-danger' : 'btn btn-primary';
  pwmSlider.value = data.pwm || 0;
  pwmVal.textContent = data.pwm || 0;
  tempVal.textContent = data.temp !== undefined ? data.temp : '--';
  humVal.textContent = data.hum !== undefined ? data.hum : '--';
});

// D4 開關
d4Btn.addEventListener("click", () => {
  onValue(statusRef, (snapshot) => {
    const data = snapshot.val() || {};
    const newD4 = data.ledD4 ? 0 : 1;
    update(statusRef, { ledD4: newD4 });
  }, { onlyOnce: true });
});

// D5 脈衝
d5Btn.addEventListener("click", () => {
  d5Btn.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> 发送中...';
  d5Btn.disabled = true;
  update(statusRef, { ledD5: 1 });
  setTimeout(() => {
    d5Btn.innerHTML = '<i class="fas fa-play"></i> 发送脉冲';
    d5Btn.disabled = false;
  }, 2000);
});

// PWM
pwmSlider.addEventListener("input", () => {
  pwmVal.textContent = pwmSlider.value;
  update(statusRef, { pwm: parseInt(pwmSlider.value) });
});
</script>
</body>
</html>
